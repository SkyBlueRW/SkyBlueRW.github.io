#

## Oh, VIX!

- [Introduction](#introduction)
- [Expected Volatility under Q](#ma)
- [The anticipated volatility and the market take](#info)
- [The numerical aspects](#numeric)
- [Appendix](#appendix)
- [Reference](#ref)

### Introduction <a name="introduction"></a>

There is the subtle feeling when reading into a 'small' yet delicate modeling like volatility index (VIX) at an era of roaring LLMs! Like many others, I got shocked by the insights, judgement and beyond that can be gained from LLM via matrix operations involving hundreds of billions of parameters. While it does not reduce any of my admiration to the think and inspiration behind a delicate structural model like VIX. Still interesting to read into it :)

It actually started as a following read about portfolio drawdown control. In the previous blogs [From Volatility to Maximum Drawdown](https://skybluerw.github.io/2023/10/15/max-drawdown.html) and [Holding Discipline for Drawdown Control](https://skybluerw.github.io/2023/12/31/drawdown-control.html), we discussed about the impact of some vital factors on the risk measure of maximum drawdown and how to control it given a (unconditional) return stochastic process. Obviously, we can do much more with tons of information out there in the market, one of which is VIX. As a market anticipation of future realized volatility, it is natural to link VIX to risk regime and further to performance of risky assets.

In this blog, let's get to the beauty of VIX. Talking more about its ituition, information embeded and numerical calculation. A spoil alert about probably everything that we are gonna to talk about in this blog. It is the market anticipate on future realized voalility explicitly defined via a hypothetical variance swap and valued by weighted average price of options with a wide range of strike prices.

### Expected Volatility under Q <a name="ma"></a>

So why bother to construct an index from options rather than look into one or a few options themselves? It is true that the premium of an option reflects views on future volatility of the underlying, while its sensitivity to volatility (vega) constantly changes as per the moneyness of the option hence giving a blurred picture. We want to zoom in a little bit with an instrument with invariant volatility exposure!

Demeterfi, Derman, Kamal & Zou (1999) provided one such solution in a sell side research report back in 1999, which is the foundation of the nowadays famous CBOE VIX index. The recepie lies in the pricing of a variance swap with payoff (V - K), where V is the future realized volatility ($$V = \frac{1}{T}\int_o^T\sigma^2(t,...)dt$$) and K is the predefined delivery price. 

To proceed with the valuation of the variance swap, we can do what we do for almost all derivatives - take the expectation of its payoff under risk neutral probability measure.
$$F = E^Q[e^{-rT}(V - K)]$$. the fair delivery price should be the expectation of future realized volatility under the risk neutral measure - the price of a derivative whose payoff mimick future volatility and a natural measure for future volatility !

$$
\begin{aligned}
K_{var} &= E^Q[V] \\
&=\frac{1}{T}E^Q[\int_o^T\sigma^2(t,...)dt]
\end{aligned}
$$

Unfortunately, the instantaneous variance ($$\sigma^2(t,...)$$) is unknown, we can not calculate $$K_{var}$$ directly with the formula. Following the spirit of relative pricing with dynamic replication, it turns out that a well designed portfolio of options (and futures) on the underlying will do us the favor for pricing $$K_{var}$$.

Long in short with some mathmatical derivations (more details about the process in the appendix), we put it in a portfolio of dynmaic underlying and static hypothetic log contract initially and end up with a portfolio of options weighted in proportion to the reverse of its strike price squared. $$S_{\star}$$ is an arbitrary price, which provides great convenience in numerical calculation and the first few terms other than option price are simply adjustment needed for this flexibility.

$$
\begin{aligned}
K_{var} &= \frac{2}{T}[rT - (\frac{S_0}{S_{\star}}e^{rT} - 1) - log\frac{S_{\star}}{S_0} \\ 
& + e^{rT}\int_0^{S_{\star}} \frac{1}{K^2}P(K)dK \\
& + e^{rT}\int_{S_{\star}}^{\infty} \frac{1}{K^2}C(K)dK ]\\
\end{aligned}
$$

It's much easier to verify that such a portfolio of options scaled by $$\dfrac{1}{K^2}$$ has a constant vega under the assumption of BSM (Black-Schole-Schole option pricing). While neither of this properoty nor the calculation of VIX depend on BSM. To make the portfolio vega invariant to underlying price, set the partial derivative to 0 leads to the weight proportional to $$\dfrac{1}{K^2}$$.

$$
\begin{aligned}
vega &= \frac{\partial C}{\partial \sigma^2} = \frac{S\sqrt{\tau}}{2\sigma}\frac{exp(-d_1^2/2)}{\sqrt{2}\pi}\\
\Pi &= \int_{0}^{\infty} w(k) O(S, K, v) dK \\
vega_{\pi} &= \int_{0}^{\infty} w(k) vega_o(S,K,v) dK \\
\end{aligned}
$$

$$
\begin{aligned}
\frac{\partial vega_{\Pi}}{\partial S} &= 0 \\
\downarrow \\
2w(k) + K\frac{\partial w(k)}{\partial K} &= 0 \\
\downarrow \\ 
w(k) &= \frac{const}{K^2}
\end{aligned}
$$

 The same has been demonstrated in the simulation of Figure 3a from DDKZ(1999), a portfolio with inifnite number of options with different strikes appropriately weighted retains invariant vega irrespective of the move of underlying asset price and passage of time hence replicate the variance swap. 


![Vega](https://raw.githubusercontent.com/SkyBlueRW/SkyBlueRW.github.io/main/_posts/asset/portfolio_vega.png)

*Source: DDKZ(1999): More Than You Ever Wanted to Know About Volatility Swaps*


### The anticipated volatility and the market take <a name="info"></a>

Now we have a portfolio of tradable options with observed prices to replicate the hypothetic variance swap. What does it capture? 

We know that the price of a derivate is simply its discounted expected payoff under risk neutral probability in a complete market without arbitrage opportunity. The VIX, in this sense, is the price of a derivative paying future realized volatility adjusted for time value. Market views of higher future volatility and more risk aversion leads to higher price of this derivative hence higher VIX.

This is aligned with what empirical research found. Jiang & Tian (2005) found VIX as a good estimator on future realized volatility even controlled for historical realized volatility - another indicator seen as good estimator on future volatility due to the existence of volatility clustering. In their regression of future realized volatility against both VIX and historical 

$$
\begin{aligned}
VIX &= K_{var} 
&=\frac{1}{T}E^Q[\int_o^T\sigma^2(t,...)dt] \\
&= E^Q[V] \\
&= e^{rT}P(V)
\end{aligned]
$$

### The numerical aspects <a name="numeric"></a>


### Appendix <a name="appendix"></a>


$$
\begin{aligned}
K_{var} &= \frac{1}{T}E^Q[\int_o^T\sigma^2(t,...)dt] \\
&= \frac{2}{T} E^Q[\int_0^T \frac{dS_t}{S_t} - d(logS_t)] \\ 
& =  \frac{2}{T} E^Q[\int_0^T\frac{dS_t}{S_t} - log(\frac{S_T}{S_0})]
\end{aligned}
$$

It is clear that, exposue to variance can be obtained via 2 positions:

1. a dynamic position on $$\frac{1}{S_t}$$ share of the underlying
2. a static position on log contract

Based on the assumption, we can get the expectation of part 1 as $$E^Q[\int_0^T \frac{dS_t}{S_t}] = rT$$

As to part 2 (the static log contract), we can obtain the log contract via the portfolio of forward and options. 

$$
\begin{aligned}
log \frac{S_T}{S_0} &= log\frac{S_T}{S_{\star}} + log\frac{S_{\star}}{S_0} \\ 
-{log\frac{S_T}{S_{\star}}} & = -\frac{S_T - S_{\star}}{S_{\star}} \\
&+\int_0^{S_\star} \frac{1}{k^2} Max(K-S_T, 0)dK \\
&+\int_{S_\star}^{\infty} \frac{1}{k^2} Max(S_T - K, 0)dK
\end{aligned}
$$

1. A short position in $$\frac{1}{S_{\star}}$$ forward contracts struk at $$S_{\star}$$
2. A long position in $$\frac{1}{K^2}$$ put options struck at K for all strikes from 0 to $$S_{\star}$$
3. a similar long position in $$\frac{1}{K^2}$$ call options struck at K, for all strikes from $$S_{\star}$$ to inf.

Take the expectation of the 2 position we got so far. We can get the VIX as below. It should be noted that $$S_{\star}$$ is an arbitrary number. 

$$
\begin{aligned}
K_{var} &= \frac{2}{T}[rT - (\frac{S_0}{S_{\star}}e^{rT} - 1) - log\frac{S_{\star}}{S_0} \\ 
& + e^{rT}\int_0^{S_{\star}} \frac{1}{K^2}P(K)dK \\
& + e^{rT}\int_{S_{\star}}^{\infty} \frac{1}{K^2}C(K)dK ]
\end{aligned}
$$


### Reference <a name="ref"></a>
- DDKZ(1999): More Than You Ever Wanted to Know About Volatility Swaps
- CBOE vix white paper
- Jiang & Tian (2005): The Model-Free Implied Volatility and Its Information Cotent
- Jiang & Tian (2009): Extracting Model-Free Volatility from Option Prices: An Examination of the VIX Index
- Carr & Wu (2008): Variance Risk Premium
